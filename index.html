<!DOCTYPE html>  
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Million Pixel - View / Buy</title>
<style>
body { margin:0; font-family:Arial; background:#111; display:flex; overflow-x:hidden; }
nav {
  position: fixed; top:0; left:0; width:100%; background:#222;
  display:flex; align-items:center; padding:10px 20px; z-index:10;
}
nav img { height:30px; margin-right:10px; }
nav h1 { color:#0f0; font-size:20px; margin-right:auto; }
nav a, nav button { color:#fff; text-decoration:none; margin-left:15px; font-size:16px; background:none; border:none; cursor:pointer; }
nav a:hover, nav button:hover { color:#0f0; }
#container { display:flex; width:100%; margin-top:60px; }
#canvasContainer { flex:1; display:flex; justify-content:center; overflow:hidden; position:relative; }
canvas { border:1px solid #222; touch-action:none; }
#sidebar {
  width:300px; background:#1a1a1a; padding:15px;
  border-left:1px solid #222; overflow-y:auto;
  display:none; color:#fff;
}
.pixelSection {
  display:flex; flex-direction:column;
  margin-bottom:10px; border:1px solid #222;
  padding:5px; border-radius:5px;
}
.pixelSection img { width:50px; height:50px; object-fit:cover; margin-bottom:5px; }
.pixelSection span { font-size:13px; margin-bottom:5px; }
.pixelSection input[type="url"], .pixelSection input[type="file"] { display:block; margin-top:5px; width:100%; }
.pixelSection:hover { background:#0033ff; cursor:pointer; }
.removePixel { background:red; color:white; border:none; padding:3px 6px; border-radius:3px; cursor:pointer; margin-top:5px; align-self:flex-end; }
#totalCost { font-size:18px; margin-top:10px; font-weight:bold; }
#checkout { margin-top:10px; padding:10px; font-size:16px; font-weight:bold; background:#0f0; border:none; color:#111; cursor:pointer; border-radius:5px; }
#checkout:hover { background:#0c0; }
#buyButton { position:fixed; top:70px; right:20px; padding:10px 15px; background:#0f0; color:#111; border:none; cursor:pointer; border-radius:5px; z-index:11; }
#buyButton:hover { background:#0c0; }
</style>
</head>
<body>

<nav>
  <img src="https://via.placeholder.com/30" alt="Logo">
  <h1>Million Pixel</h1>
  <a href="about.html">About Us</a>
  <button id="langBtn">üåê EN</button>
</nav>

<button id="buyButton">Buy Pixels</button>

<div id="container">
  <div id="canvasContainer">
    <canvas id="pixelCanvas"></canvas>
  </div>
  <div id="sidebar">
    <h2>Selected Pixels</h2>
    <label><input type="checkbox" id="singleLink"> Use one Website URL for all</label><br>
    <label><input type="checkbox" id="singleImage"> Use one Image for all</label>
    <div id="pixelList"></div>
    <div id="totalCost">Total Cost: 0 JOD</div>
    <button id="checkout">Checkout</button>
  </div>
</div>

<script>
const canvas = document.getElementById('pixelCanvas');
const ctx = canvas.getContext('2d');
const sidebar = document.getElementById('sidebar');
const pixelList = document.getElementById('pixelList');
const totalCostEl = document.getElementById('totalCost');
const singleLinkCheckbox = document.getElementById('singleLink');
const singleImageCheckbox = document.getElementById('singleImage');
const buyButton = document.getElementById('buyButton');
const langBtn = document.getElementById('langBtn');

// GRID CONFIG
const cols = 1000, rows = 1000, pixelSize = 5; // 1M pixels
canvas.width = cols * pixelSize;
canvas.height = rows * pixelSize;

let purchasedPixels = {}; // { "y,x": "url" }
let selectedPixels = [];
let buyMode=false;
let scale = 1, offsetX = 0, offsetY = 0;
let isPanning = false, lastX=0, lastY=0;

// DRAW GRID
function drawPixels(){
  ctx.setTransform(scale,0,0,scale,offsetX,offsetY);
  ctx.clearRect(-offsetX/scale, -offsetY/scale, canvas.width/scale, canvas.height/scale);

  for(let y=0;y<rows;y++){
    for(let x=0;x<cols;x++){
      const key=`${y},${x}`;
      if(purchasedPixels[key]) ctx.fillStyle="#0a0";
      else if(selectedPixels.find(p=>p.row==y && p.col==x)) ctx.fillStyle="#0f0";
      else ctx.fillStyle="#333";
      ctx.fillRect(x*pixelSize,y*pixelSize,pixelSize,pixelSize);
    }
  }
}
drawPixels();

// CANVAS CLICK
canvas.addEventListener("click", e=>{
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor(((e.clientX-rect.left)-offsetX)/ (pixelSize*scale));
  const y = Math.floor(((e.clientY-rect.top)-offsetY)/ (pixelSize*scale));
  const key = `${y},${x}`;
  if(x<0||y<0||x>=cols||y>=rows) return;

  if(buyMode){
    if(purchasedPixels[key]) return;
    const idx = selectedPixels.findIndex(p=>p.row==y&&p.col==x);
    if(idx>-1) selectedPixels.splice(idx,1);
    else selectedPixels.push({row:y,col:x,image:null,link:""});
    updateSidebar();
  } else {
    if(purchasedPixels[key]) window.open(purchasedPixels[key],'_blank');
  }
  drawPixels();
});

// PAN & ZOOM
canvas.addEventListener("mousedown", e=>{ isPanning=true; lastX=e.clientX; lastY=e.clientY; });
canvas.addEventListener("mouseup", ()=>isPanning=false);
canvas.addEventListener("mousemove", e=>{
  if(isPanning){ offsetX+=e.clientX-lastX; offsetY+=e.clientY-lastY; lastX=e.clientX; lastY=e.clientY; drawPixels(); }
});
canvas.addEventListener("wheel", e=>{
  e.preventDefault();
  const zoom = e.deltaY<0 ? 1.1 : 0.9;
  scale *= zoom; scale = Math.min(Math.max(0.2,scale),20);
  drawPixels();
});

// TOUCH SUPPORT
let touchStartDist=0;
canvas.addEventListener("touchstart", e=>{
  if(e.touches.length==2){
    touchStartDist = Math.hypot(
      e.touches[0].clientX-e.touches[1].clientX,
      e.touches[0].clientY-e.touches[1].clientY
    );
  }
});
canvas.addEventListener("touchmove", e=>{
  e.preventDefault();
  if(e.touches.length==1){
    offsetX+=e.touches[0].movementX||0;
    offsetY+=e.touches[0].movementY||0;
  } else if(e.touches.length==2){
    const dist=Math.hypot(
      e.touches[0].clientX-e.touches[1].clientX,
      e.touches[0].clientY-e.touches[1].clientY
    );
    if(touchStartDist){
      let zoom=dist/touchStartDist;
      scale*=zoom; scale=Math.min(Math.max(0.2,scale),20);
    }
    touchStartDist=dist;
  }
  drawPixels();
},{passive:false});

// SIDEBAR UPDATE
function updateSidebar(){
  if(selectedPixels.length>0) sidebar.style.display="block";
  else sidebar.style.display="none";
  pixelList.innerHTML="";
  selectedPixels.forEach((p,i)=>{
    const div=document.createElement('div');
    div.className="pixelSection"; div.dataset.index=i;
    div.innerHTML=`
      <img src="${p.image||'https://via.placeholder.com/50'}">
      <span>Row:${p.row} Col:${p.col}</span>
      <input type="file" class="imageInput" data-index="${i}" accept="image/*">
      <input type="url" class="linkInput" placeholder="Website URL" data-index="${i}">
      <button class="removePixel" data-index="${i}">‚ùå Remove</button>`;
    pixelList.appendChild(div);
  });
  totalCostEl.textContent=`Total Cost: ${selectedPixels.length} JOD`;
}

// FILE/URL HANDLING + REMOVE
pixelList.addEventListener("change", e=>{
  const idx = e.target.dataset.index;
  if(e.target.classList.contains("imageInput")){
    const file = e.target.files[0];
    const reader=new FileReader();
    reader.onload=ev=>{ selectedPixels[idx].image=ev.target.result; updateSidebar(); }
    if(file) reader.readAsDataURL(file);
  } else if(e.target.classList.contains("linkInput")) selectedPixels[idx].link=e.target.value;
});
pixelList.addEventListener("click", e=>{
  if(e.target.classList.contains("removePixel")){
    const idx=e.target.dataset.index;
    selectedPixels.splice(idx,1); updateSidebar(); drawPixels();
  }
});

// SINGLE OPTIONS
singleLinkCheckbox.addEventListener("change",()=>{
  const inputs=document.querySelectorAll(".linkInput");
  inputs.forEach(input=>input.style.display=singleLinkCheckbox.checked?"none":"block");
});
singleImageCheckbox.addEventListener("change",()=>{
  const inputs=document.querySelectorAll(".imageInput");
  inputs.forEach(input=>input.style.display=singleImageCheckbox.checked?"none":"block");
});

// CHECKOUT
document.getElementById("checkout").addEventListener("click",()=>{
  if(singleLinkCheckbox.checked){
    const link=prompt("Enter one Website URL:");
    selectedPixels.forEach(p=>p.link=link);
  }
  if(singleImageCheckbox.checked){
    const fileInput=document.createElement("input");
    fileInput.type="file"; fileInput.accept="image/*";
    fileInput.onchange=()=>{
      const file=fileInput.files[0];
      const reader=new FileReader();
      reader.onload=ev=>{
        selectedPixels.forEach(p=>p.image=ev.target.result);
        updateSidebar();
      }
      if(file) reader.readAsDataURL(file);
    };
    fileInput.click();
  }
  alert(`Purchasing ${selectedPixels.length} pixel(s) for ${selectedPixels.length} JOD`);
});

// BUY MODE
buyButton.addEventListener("click",()=>{
  buyMode=!buyMode;
  buyButton.textContent=buyMode?"Exit Buy Mode":"Buy Pixels";
  if(!buyMode){ selectedPixels=[]; updateSidebar(); drawPixels(); }
});

// LANGUAGE SWITCH (demo EN/AR)
langBtn.addEventListener("click",()=>{
  if(langBtn.textContent.includes("EN")){ langBtn.textContent="üåê AR"; document.querySelector("h1").textContent="ŸÖŸÑŸäŸàŸÜ ÿ®ŸÉÿ≥ŸÑ"; }
  else{ langBtn.textContent="üåê EN"; document.querySelector("h1").textContent="Million Pixel"; }
});
</script>
</body>
</html>
