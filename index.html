<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Million Hope</title>
<style>
:root{
  --bg:#f9f9f9;
  --grid:#ccc;
  --panel:#fff;
  --accent:#4CAF50;
  --hover:#2196F3;
  --selected:#4CAF50;
  --text:#333;
  --muted:#666;
}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
  color:var(--text);
  overflow:hidden;
}
nav{
  position:fixed;
  left:0; right:0; top:0;
  height:56px;
  background:var(--panel);
  display:flex;
  align-items:center;
  padding:0 12px;
  border-bottom:1px solid #ddd;
  z-index:40;
}
nav img{height:34px;margin-right:10px}
nav h1{font-size:18px;margin:0;flex:1}
nav .nav-btn{margin-left:12px;padding:6px 10px;border:none;border-radius:6px;background:var(--accent);color:#fff;cursor:pointer}
#canvasContainer{
  position:absolute;
  top:56px; left:0; right:0; bottom:0;
  background:#fff;
  overflow:hidden;
}
canvas{
  display:block;
  width:100%;
  height:100%;
  cursor:crosshair;
}
#sidebar{
  position:fixed;
  top:56px; right:-380px;
  width:380px; bottom:0;
  background:var(--panel);
  border-left:1px solid #ddd;
  padding:12px;
  overflow-y:auto;
  transition:right .25s;
  z-index:45;
}
#sidebar.open{right:0;}
#sidebar h2{margin:6px 0 10px 0}
.pixelSection{
  display:flex; gap:8px; align-items:flex-start;
  border:1px solid #ddd;
  padding:6px;
  border-radius:6px;
  margin-bottom:6px;
  position:relative;
  background:#f5f5f5;
}
.pixelSection img{
  width:56px; height:56px; object-fit:cover; border-radius:4px;
}
.pixelMeta{flex:1;font-size:13px}
.pixelMeta input{width:100%;margin-top:6px;padding:6px;border-radius:4px;border:1px solid #ccc}
.removePixel{
  position:absolute;top:6px;right:6px;
  background:#cc3333;color:#fff;border:none;
  border-radius:50%;width:24px;height:24px;
  cursor:pointer;
}
.controlBtn{
  width:100%;
  background:var(--accent);
  color:#fff;
  border:none;
  padding:10px;
  border-radius:6px;
  margin-bottom:6px;
  cursor:pointer;
}
</style>
</head>
<body>
<nav>
<img src="https://via.placeholder.com/34" alt="logo">
<h1>Million Hope</h1>
<button class="nav-btn">Contact Us</button>
<button class="nav-btn">About Us</button>
<button class="nav-btn">Language</button>
</nav>

<div id="canvasContainer">
<canvas id="pixelCanvas"></canvas>
</div>

<div id="sidebar" aria-hidden="true">
<h2>Buy Pixels</h2>
<label>
<input type="checkbox" id="applySameImage"> Apply same image for all
</label>
<label>
<input type="checkbox" id="applySameLink"> Apply same hyperlink for all
</label>
<div style="margin:6px 0">
<button id="uploadSlice" class="controlBtn">Slice Image Across Selection</button>
<button id="clearSelectionSidebar" class="controlBtn">Clear Selection</button>
</div>
<div id="pixelList"></div>
<button id="checkout" class="controlBtn">Checkout</button>
</div>

<div class="controls" style="position:fixed;top:60px;right:12px;z-index:46;">
<button id="buyButton" class="controlBtn">Buy Pixels</button>
</div>

<script>
const COLS=1000, ROWS=1000;
const PRICE_PER_PIXEL=1;
let purchasedPixels={'500,500':{}}; // one free pixel for testing
let selectedPixels=[];
let hoveredCell=null;
let scale=1, offsetX=0, offsetY=0;
let isDragging=false, dragStart={x:0,y:0};
let boxSelectMode=false, boxSelecting=false, boxStart=null, boxRect=null;

const canvas=document.getElementById('pixelCanvas');
const ctx=canvas.getContext('2d');
const container=document.getElementById('canvasContainer');
const sidebar=document.getElementById('sidebar');
const pixelList=document.getElementById('pixelList');

function resizeCanvas(){
  canvas.width=container.clientWidth;
  canvas.height=container.clientHeight;
  scale=Math.min(canvas.width/COLS,canvas.height/ROWS);
  offsetX=(canvas.width-COLS*scale)/2;
  offsetY=(canvas.height-ROWS*scale)/2;
  draw();
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

function screenToWorld(x,y){
  return {x:(x-offsetX)/scale, y:(y-offsetY)/scale};
}
function worldToCell(x,y){
  const col=Math.floor(x), row=Math.floor(y);
  if(col<0||row<0||col>=COLS||row>=ROWS) return null;
  return {row,col};
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // background
  ctx.fillStyle='#fff';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  // grid
  ctx.strokeStyle='#ccc';
  ctx.lineWidth=0.3;
  for(let i=0;i<=COLS;i+=10){
    const x=i*scale+offsetX;
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
  }
  for(let i=0;i<=ROWS;i+=10){
    const y=i*scale+offsetY;
    ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
  }
  // purchased pixels
  ctx.fillStyle='#aaa';
  for(let key in purchasedPixels){
    const [r,c]=key.split(',').map(Number);
    ctx.fillRect(c*scale+offsetX,r*scale+offsetY,scale,scale);
  }
  // selected pixels
  for(let p of selectedPixels){
    ctx.fillStyle=(hoveredCell && hoveredCell.row===p.row && hoveredCell.col===p.col)?'#2196F3':'#4CAF50';
    ctx.fillRect(p.col*scale+offsetX,p.row*scale+offsetY,scale,scale);
  }
  // box select overlay
  if(boxSelecting && boxRect){
    ctx.strokeStyle='#2196F3';
    ctx.lineWidth=2;
    ctx.strokeRect(boxRect.left,boxRect.top,boxRect.right-boxRect.left,boxRect.bottom-boxRect.top);
  }
}

canvas.addEventListener('mousedown',e=>{
  if(e.button!==0) return;
  if(boxSelectMode){
    boxSelecting=true;
    boxStart={x:e.clientX,y:e.clientY};
    boxRect=null;
    return;
  }
  isDragging=true;
  dragStart.x=e.clientX-offsetX;
  dragStart.y=e.clientY-offsetY;
});
window.addEventListener('mousemove',e=>{
  if(isDragging&&!boxSelecting){
    offsetX=e.clientX-dragStart.x;
    offsetY=e.clientY-dragStart.y;
    draw();
  }
  if(boxSelecting){
    boxRect={left:Math.min(boxStart.x,e.clientX),
      top:Math.min(boxStart.y,e.clientY),
      right:Math.max(boxStart.x,e.clientX),
      bottom:Math.max(boxStart.y,e.clientY)};
    draw();
  }
  // hover
  const rect=canvas.getBoundingClientRect();
  const wx=(e.clientX-rect.left-offsetX)/scale;
  const wy=(e.clientY-rect.top-offsetY)/scale;
  const cell=worldToCell(wx,wy);
  hoveredCell=cell && selectedPixels.find(p=>p.row===cell.row&&p.col===cell.col)?cell:null;
  draw();
});
window.addEventListener('mouseup',e=>{
  if(isDragging) isDragging=false;
  if(boxSelecting){
    selectBoxPixels();
    boxSelecting=false;
    boxStart=null;
    boxRect=null;
    draw();
  }
});

canvas.addEventListener('click',e=>{
  if(!boxSelectMode){
    const rect=canvas.getBoundingClientRect();
    const {x,y}=screenToWorld(e.clientX-rect.left,e.clientY-rect.top);
    const cell=worldToCell(x,y);
    if(!cell) return;
    const key=`${cell.row},${cell.col}`;
    if(purchasedPixels[key]) return;
    const idx=selectedPixels.findIndex(p=>p.row===cell.row&&p.col===cell.col);
    if(idx>-1) selectedPixels.splice(idx,1);
    else selectedPixels.push({row:cell.row,col:cell.col,image:null,link:''});
    updateSidebar();
    draw();
  }
});

function selectBoxPixels(){
  if(!boxRect) return;
  const rect=canvas.getBoundingClientRect();
  const x0=Math.floor((boxRect.left-rect.left-offsetX)/scale);
  const y0=Math.floor((boxRect.top-rect.top-offsetY)/scale);
  const x1=Math.floor((boxRect.right-rect.left-offsetX)/scale);
  const y1=Math.floor((boxRect.bottom-rect.top-offsetY)/scale);
  for(let r=y0;r<=y1;r++){
    for(let c=x0;c<=x1;c++){
      const key=`${r},${c}`;
      if(purchasedPixels[key]) continue;
      if(!selectedPixels.find(p=>p.row===r&&p.col===c))
        selectedPixels.push({row:r,col:c,image:null,link:''});
    }
  }
  updateSidebar();
}

// Sidebar
const buyButton=document.getElementById('buyButton');
buyButton.addEventListener('click',()=>{
  sidebar.classList.add('open');
  if(selectedPixels.length===0){
    alert('Select pixels to start buying!');
  }
  draw();
});

function updateSidebar(){
  pixelList.innerHTML='';
  selectedPixels.forEach((p,i)=>{
    const div=document.createElement('div');
    div.className='pixelSection';
    div.innerHTML=`
      <button class="removePixel" data-index="${i}">Ã—</button>
      <img src="${p.image||'https://via.placeholder.com/56'}">
      <div class="pixelMeta">
        <input type="file" class="imageInput" data-index="${i}">
        <input type="url" class="linkInput" placeholder="https://example.com" data-index="${i}" value="${p.link||''}">
      </div>`;
    div.querySelector('.removePixel').addEventListener('click',()=>{selectedPixels.splice(i,1);updateSidebar();draw();});
    div.addEventListener('mouseenter',()=>{hoveredCell=p;draw();});
    div.addEventListener('mouseleave',()=>{hoveredCell=null;draw();});
    pixelList.appendChild(div);
  });
  // add events for image upload/link input
  pixelList.querySelectorAll('.imageInput').forEach(inp=>{
    inp.onchange=e=>{
      const idx=parseInt(e.target.dataset.index);
      const file=e.target.files[0];
      if(file){
        const url=URL.createObjectURL(file);
        if(document.getElementById('applySameImage').checked){
          selectedPixels.forEach(p=>p.image=url);
        }else selectedPixels[idx].image=url;
        updateSidebar();
        draw();
      }
    }
  });
  pixelList.querySelectorAll('.linkInput').forEach(inp=>{
    inp.onchange=e=>{
      const idx=parseInt(e.target.dataset.index);
      if(document.getElementById('applySameLink').checked){
        selectedPixels.forEach(p=>p.link=e.target.value);
      }else selectedPixels[idx].link=e.target.value;
    }
  });
}

// Clear selection
document.getElementById('clearSelectionSidebar').addEventListener('click',()=>{
  selectedPixels=[];
  updateSidebar();
  draw();
});

// Slice Image Across Selection
document.getElementById('uploadSlice').addEventListener('click',()=>{
  const fileInput=document.createElement('input');
  fileInput.type='file';
  fileInput.accept='image/*';
  fileInput.click();
  fileInput.onchange=e=>{
    const file=fileInput.files[0];
    if(!file) return;
    const img=new Image();
    img.onload=()=>{
      // slice image across selected pixels proportionally
      const rows=Math.max(...selectedPixels.map(p=>p.row))-Math.min(...selectedPixels.map(p=>p.row))+1;
      const cols=Math.max(...selectedPixels.map(p=>p.col))-Math.min(...selectedPixels.map(p=>p.col))+1;
      const minRow=Math.min(...selectedPixels.map(p=>p.row));
      const minCol=Math.min(...selectedPixels.map(p=>p.col));
      const sliceWidth=img.width/cols;
      const sliceHeight=img.height/rows;
      selectedPixels.forEach(p=>{
        const x=p.col-minCol;
        const y=p.row-minRow;
        const canvasTmp=document.createElement('canvas');
        canvasTmp.width=sliceWidth;
        canvasTmp.height=sliceHeight;
        const ctxTmp=canvasTmp.getContext('2d');
        ctxTmp.drawImage(img,x*sliceWidth,y*sliceHeight,sliceWidth,sliceHeight,0,0,sliceWidth,sliceHeight);
        p.image=canvasTmp.toDataURL();
      });
      updateSidebar();
      draw();
    };
    img.src=URL.createObjectURL(file);
  };
});

setInterval(draw,100);
</script>
</body>
</html>
